import{_ as s,c as e,o as a,V as i}from"./chunks/framework.-lsX7DWn.js";const g=JSON.parse('{"title":"Runbook de depuración","description":"","frontmatter":{},"headers":[],"relativePath":"get-start/runbook.md","filePath":"get-start/runbook.md"}'),n={name:"get-start/runbook.md"},t=i(`<h1 id="runbook-de-depuracion" tabindex="-1">Runbook de depuración <a class="header-anchor" href="#runbook-de-depuracion" aria-label="Permalink to &quot;Runbook de depuración&quot;">​</a></h1><div class="info custom-block"><p class="custom-block-title">INFO</p><p>La fuente original (en ingles) de este tutorial se encuentra <a href="https://mswjs.io/docs/runbook" target="_blank" rel="noreferrer">aquí</a></p></div><p>Depurar problemas comunes con MSW.</p><p>A continuación puede encontrar los problemas más comunes que experimentan los desarrolladores al integrar Mock Service Worker en sus aplicaciones. Lea esta página antes de abrir un problema en GitHub, ya que existe una buena posibilidad de que haya una respuesta a su problema a continuación.</p><h2 id="antes-de-que-empieces" tabindex="-1">Antes de que empieces <a class="header-anchor" href="#antes-de-que-empieces" aria-label="Permalink to &quot;Antes de que empieces&quot;">​</a></h2><h2 id="verifique-la-version-de-node-js" tabindex="-1">Verifique la versión de Node.js <a class="header-anchor" href="#verifique-la-version-de-node-js" aria-label="Permalink to &quot;Verifique la versión de Node.js&quot;">​</a></h2><p>Verifique la versión de Node.js que está usando su proyecto:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span></span></code></pre></div><p>Si es inferior a Node.js v18, <a href="https://nodejs.org/en" target="_blank" rel="noreferrer">actualice a la última versión de Node.js</a>. No investigamos los problemas que ocurren en versiones no compatibles de Node.js.</p><h2 id="verifique-la-version-de-msw" tabindex="-1">Verifique la versión de MSW <a class="header-anchor" href="#verifique-la-version-de-msw" aria-label="Permalink to &quot;Verifique la versión de MSW&quot;">​</a></h2><p>Primero, verifique qué versión del paquete <code>msw</code> tiene instalada:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls msw</span></span></code></pre></div><p>Luego, verifique la última versión de publicación:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> view msw version</span></span></code></pre></div><p>Si estos dos difieren, actualice la versión de <code>msw</code> en su proyecto y vea si el problema persiste.</p><h2 id="runbook-de-depuracion-1" tabindex="-1">Runbook de depuración <a class="header-anchor" href="#runbook-de-depuracion-1" aria-label="Permalink to &quot;Runbook de depuración&quot;">​</a></h2><p>Verificó el entorno y las versiones de MSW, pero el problema persiste. Es hora de hacer un poco de depuración. A continuación, puede encontrar un runbook de depuración paso a paso que debe seguir cuando experimente cualquier comportamiento inesperado con MSW.</p><h2 id="paso-1-verificar-la-configuracion" tabindex="-1">Paso 1: Verificar la configuración <a class="header-anchor" href="#paso-1-verificar-la-configuracion" aria-label="Permalink to &quot;Paso 1: Verificar la configuración&quot;">​</a></h2><p>Primero, verifique que MSW esté configurado correctamente. Tome la instancia <code>worker</code>/<code>server</code> y agréguele un nuevo detector de eventos de ciclo de vida <code>request:start</code>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server.events.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;request:start&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Outgoing:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, request.method, request.url)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>Puede obtener más información sobre la <a href="./../api/life-cycle-events.html">API de eventos del ciclo de vida</a>.</p><p>Con este oyente implementado, debería ver el mensaje de la consola <em>en cada solicitud saliente</em> que intercepte MSW. El mensaje de la consola debería verse así:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Outgoing:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET https://api.example.com/some/request</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Outgoing:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST http://localhost/post/abc-123</span></span></code></pre></div><p><strong>Debe ver el método de solicitud y la URL de solicitud absoluta</strong>. Si el método de solicitud es diferente, ajuste su controlador de solicitudes para reflejarlo. Si ve una <em>URL de solicitud relativa</em>, su cliente de solicitud o su entorno de prueba no están configurados correctamente. Debe configurar la opción de URL base de su cliente de solicitud para producir URL de solicitud absolutas y su entorno de prueba para tener configurado <code>document.baseURI</code>.</p><p>De lo contrario, <strong>verifique que se imprima la solicitud problemática</strong>. Si es así, continúe con el siguiente paso.</p><blockquote><p>Si la solicitud problemática es la única solicitud que realiza su aplicación, intente agregar una llamada de recuperación ficticia en cualquier lugar después de la configuración de MSW para confirmar este paso. Por ejemplo:</p></blockquote><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Si no se imprime ningún mensaje para la solicitud problemática (o cualquier solicitud), es probable que MSW no esté configurado correctamente y no pueda interceptar las solicitudes. Consulte las <a href="./../get-start/getting-started.html#paso-3-integre-en-cualquier-lugar">instrucciones de integración</a> y asegúrese de configurar la biblioteca como se ilustra allí.</p><h2 id="paso-2-verificar-el-manejador" tabindex="-1">Paso 2: Verificar el manejador <a class="header-anchor" href="#paso-2-verificar-el-manejador" aria-label="Permalink to &quot;Paso 2: Verificar el manejador&quot;">​</a></h2><p>Vaya al manejador de solicitudes que creó para la solicitud problemática y agregue una declaración de consola en su función de resolución.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// src/mocks/handlers.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { http } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;msw&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> handlers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/some/request&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Handler&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, request.method, request.url)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // The rest of the response resolver here.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p>Debería ver este mensaje de consola cuando ocurra la solicitud problemática en la page/tests. Si es así, continúe con el siguiente paso.</p><p>Si no hay ningún mensaje, MSW puede interceptar la solicitud pero <em>no puede compararla con este controlador</em>. Esto probablemente significa que el predicado de su controlador de solicitudes no coincide con la URL de solicitud real. <strong>Verifique que el predicado sea correcto</strong>. Algunos de los problemas comunes incluyen:</p><ul><li>Usar una variable de entorno en la ruta, que no está configurada en pruebas/CI (por ejemplo, <code>http.get(BASE_URL + &#39;/path&#39;))</code>). Inspeccione cualquier segmento dinámico de la ruta de solicitud y asegúrese de que tenga los valores esperados;</li><li>Errores tipográficos en la ruta de la solicitud. Examine detenidamente la solicitud impresa en el paso anterior de este runbook y encuentre cualquier error tipográfico o error en ella.</li></ul><p>Si no está seguro, lea la documentación sobre cómo interceptar solicitudes con MSW:</p><div class="info custom-block"><p class="custom-block-title">Interceptando solicitudes</p><p><a href="./../basics/intercepting-requests.html">Obtenga información sobre la interceptación de solicitudes y cómo capturar solicitudes REST y GraphQL.</a></p></div><h2 id="paso-3-verificar-la-respuesta" tabindex="-1">Paso 3: Verificar la respuesta <a class="header-anchor" href="#paso-3-verificar-la-respuesta" aria-label="Permalink to &quot;Paso 3: Verificar la respuesta&quot;">​</a></h2><p>Si se invoca el controlador de solicitudes pero la solicitud aún no recibe la respuesta simulada, el siguiente lugar a verificar es la respuesta simulada en sí. En el controlador de solicitudes, salte a las respuestas simuladas que defina.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// src/mocks/handlers.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { http, HttpResponse } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;msw&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> handlers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/some/request&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Handler&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, request.method, request.url)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpResponse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ mocked: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p><strong>Verifique que está construyendo una respuesta válida</strong>. Puede asignar la respuesta a una variable e imprimirla para inspeccionarla. También puede devolver anticipadamente una respuesta ficticia simulada y ver si su aplicación la recibe.</p><p>Si no está seguro, lea sobre las respuestas simuladas de MSW:</p><div class="info custom-block"><p class="custom-block-title">Respuestas Simuladas</p><p><a href="./../basics/mocking-responses.html">Obtenga más información sobre los solucionadores de respuestas y las diferentes maneras de responder a una solicitud.</a></p></div><p>Si no ha descubierto ningún problema con la respuesta simuladas, continúe con el siguiente paso.</p><h2 id="paso-4-verificar-la-aplicacion" tabindex="-1">Paso 4: Verificar la aplicación <a class="header-anchor" href="#paso-4-verificar-la-aplicacion" aria-label="Permalink to &quot;Paso 4: Verificar la aplicación&quot;">​</a></h2><p>Si ninguno de los pasos anteriores ha resultado fructífero, es probable que el problema esté en la lógica de manejo de solicitud/respuesta de su aplicación. Vaya al código fuente que realiza la solicitud y maneja la respuesta, y verifique que sean correctos. Siga cuidadosamente las pautas de su framework de solicitudes para asegurarse de realizar las solicitudes según lo previsto.</p><p>Si el problema persiste, <a href="https://github.com/mswjs/msw/issues/new/choose" target="_blank" rel="noreferrer">abra una nueva edición en GitHub</a> y proporcione un repositorio de reproducción mínimo. Los problemas sin el repositorio de reproducción donde el problema pueda reproducirse de manera confiable se cerrarán automáticamente.</p>`,46),l=[t];function r(o,p,d,c,h,u){return a(),e("div",null,l)}const E=s(n,[["render",r]]);export{g as __pageData,E as default};
